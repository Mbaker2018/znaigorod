<% range = affiche.showings_grouped_by_day(params[:search]) %>

<% unless range.keys.one? %>

  <div class="seance_tabs">
    <ul>
      <% range.keys.each_with_index do |day, index| %>
        <li class='fake <%= 'active' if index==0 %>' id='target_t<%= "#{affiche.id}#{index}" %>'>
          <a href="#"><span class='day'><%= l day, :format => '%e %b' %></span><span class="dow"><%= l(day, :format => '%A').mb_chars.downcase %></span></a>
        </li>
      <% end %>
    </ul>
  </div>

<% end %>

<div class="seances_wrapper">
  <% index = 0 %>
  <% range.each do |date, showings| %>

    <div class='showing_wrapper' <%= "style='display: none;'" unless index.zero? %> id='t<%= "#{affiche.id}#{index}" %>'>
    <% if Movie === affiche %>
      <table class="sortable">
        <thead>
          <tr>
            <th class='time'><a href='#' class='dashed_deep_blue'>Время</a></th>
            <th class='cinema'><a href='#' class='dashed_deep_blue'>Кинотеатр</a></th>
            <th class='hall'><a href='#' class='dashed_deep_blue'>Зал</a></th>
            <th class='amount'><a href='#' class='dashed_deep_blue'>Стоимость</a></th>
          </tr>
        </thead>
        <tbody>
          <% showings.each do |showing| %>
            <tr>
              <td><%= l(showing.starts_at, :format => '%H:%M') %></td>
              <td><%= showing.place %></td>
              <td><%= showing.hall %></td>
              <td><%= price_for(showing) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <% showings.group_by(&:place).each do |place, showings| %>
        <ul>
          <li>
            <span class='label'>Место проведения</span>
            <%= place %>
          </li>
          <li>
            <span class='label'>Время проведения</span>
            <%= showings.map{|s| l(s.starts_at, :format => '%e %b в %H:%M')}.join(', ') %>
          </li>
          <li>
            <span class="label">Стоимость</span>
            <%= showings.map{|s| price_for(s) }.join(', ') %>
          </li>
        </ul>
      <% end %>
    <% end %>
    </div>

    <% index += 1 %>
  <% end %>
</div>
