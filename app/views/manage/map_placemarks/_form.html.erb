<% content_for :yandex_map_scripts, javascript_include_tag('http://api-maps.yandex.ru/2.0.34/?load=package.full&lang=ru-RU') %>
<div class="map_placemark_form">
  <h1>Отметка на карте:</h1>
  <%= simple_form_for [:manage, @map_project, resource] do |f| %>
    <%= f.association :map_layer, collection: @map_project.map_layers, prompt: 'Выберите слой' %>
    <div class='relations'>
      <p class="title">Эта метка связана с:</p>
      <div class='sticky_elements'>
        <% resource.relations.each do |item| %>
          <div class="element">
            <%= link_to item.slave.title.truncate(30), item.slave.is_a?(Afisha) ? afisha_show_path(item.slave) : item.slave, :target => '_blank' %>
            <span class="del_icon"></span>
            <%= hidden_field_tag "map_placemark[related_items][]","#{item.slave_type.underscore}_#{item.slave_id}", class: "hidden_ids" %>
          </div>
        <% end %>
      </div>

      <div style='clear: both'></div>

      <div class='select_and_search'>
        <%= select_tag 'type_select', options_for_select([ ['Афиша', '/my/related_afishas'], ['Организация', '/my/related_organizations'] ]), { class: 'type_select' }  %>
        <%= button_tag '', type: 'button', remote: true, class: 'sbm' %>
        <%= text_field_tag :search, '', { class: 'related_search' } %>
      </div>

      <div style='clear: both'></div>

      <div class='results infinite_list'>
        <ul class='posters'></ul>
      </div>
      <input type="hidden" value="map_placemark[related_items][]" class="params_name">
    </div>
    <div class="not_zg_objects">
      <%= f.input :title %>
      <%= f.input :latitude, as: :hidden %>
      <%= f.input :longitude, as: :hidden %>
      <%= f.input :url %>
      <%= f.input :address %>
      <%= f.input :image %>
      <%= link_to 'указать местоположение на карте', '#', :class => 'choose_coordinates' %>
    </div>
    <%= f.submit %>
    <%= link_to 'Назад', manage_map_project_path(@map_project) %>
  <% end %>
</div>
